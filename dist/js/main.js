
function readyGo(){$(document).ready(function(){var view={};view.markers=[];view.map=null;view.infoWindo=null;view.initMap=undefined;var noResults=[{name:'No matches found'}];var locationList=[{name:'Caribou Coffee',address:'501 Medlock Bridge Rd',city:'Suwanee',state:'GA',distance:null,current:false,lat:34.00845306494651,lng:-84.19300499023431},{name:'San Franscisco Coffee Roasting Co',address:'676 N Highland Ave NE',city:'Atlanta',state:null,distance:null,current:false,lat:33.772911702767,lng:-84.352718412257},{name:'45 Cafe',address:'45 S Peachtree St',city:'Norcross',state:'GA',distance:null,current:false,lat:33.941786219080,lng:-84.21318948855},{name:'Starbucks',address:'9700 Medlock Bridge Rd',city:'Duluth',state:'GA',distance:null,current:false,lat:34.0171,lng:-84.19144},{name:'Octane Coffee',address:'1009 Marietta St. NW',city:'Atlanta',state:'GA',distance:null,current:false,lat:33.77932568445548,lng:-84.41016912460327}];var Location=function(data){var self=this;this.name=ko.observable(data.name);this.address=ko.observable(data.address);this.city=ko.observable(data.city);this.state=ko.observable(data.state);this.distance=ko.observable(data.distance);this.lat=ko.observable(data.lat);this.lng=ko.observable(data.lng);this.myMarker='';this.isSelected=ko.observable(false);this.bounceTO=[];this.toggleBounce=function(){self.centerMap();if(self.myMarker.getAnimation()!==null){self.myMarker.setAnimation(null);}else{self.clearBounceTimeOut();self.myMarker.setAnimation(google.maps.Animation.BOUNCE);self.bounceTO.push(setTimeout(function(){self.myMarker.setAnimation(null);},1000));}};this.centerMap=function(pos){view.map.setCenter(pos);};this.infoWindow=function(data){if(view.infoWindow.map===null){view.infoWindow=new google.maps.InfoWindow({map:view.map,pixelOffset:new google.maps.Size(0,-30)});}
var pos={lat:self.lat(),lng:self.lng()};if(data.response.venues.length<1){view.infoWindow.setContent('There is no FourSquare data on this location.');view.infoWindow.setPosition(pos);self.clearTimeOut();self.clearInfoWindow();self.toggleBounce();return null;}
var text1=data.response.venues[0].contact.formattedPhone;var text2=data.response.venues[0].url;if(text1===''||text1===undefined||text1===null){text1='Sorry, FourSquare cannot find a phone number';}
if(text2===''||text2===undefined||text2===null){text2='Sorry, FourSquare cannot find a url';}
var text=self.name()+'....FourSquare says: call them at '+text1+'....or  FourSquare says: find them on the web at: '+text2;view.infoWindow.setPosition(pos);view.infoWindow.setContent(text);self.clearTimeOut();self.clearInfoWindow();self.toggleBounce();};this.timeOut=[];this.clearInfoWindow=function(){self.timeOut.push(setTimeout(function(){view.infoWindow.close();},15000));};this.clearTimeOut=function(){for(var i=0;i<self.timeOut.length;i++){clearTimeout(self.timeOut[i]);}};this.clearBounceTimeOut=function(){for(var i=0;i<self.bounceTO.length;i++){clearTimeout(self.bounceTO[i]);}};this.fsWait=function(object){var pos={lat:object.lat(),lng:object.lng()};self.clearTimeOut();view.infoWindow.setPosition(pos);view.infoWindow.setContent('...Waiting for fourSquare');self.getFsInfo();};this.fsFail=function(){var text='FourSquare did not respond to your request. Please try again.';var pos={lat:self.lat(),lng:self.lng()};view.infoWindow.setPosition(pos);view.infoWindow.setContent(text);self.centerMap();};this.getFsInfo=function(){self.queryFsUrl=ko.observable('https://api.foursquare.com/v2/venues/search?client_id=1ZG2MGU33AXFYJPBZ2JNP1FXHDPBATKXVKKBFCFMKB1ABMNN&client_secret=0B43AA2S0DNA1UZTGGXOY2LXDK3ZFOMZGCSYOVXXWQDHWMTF&v=20130815&ll='+self.lat()+','+self.lng()+'&query='+self.name());$.ajax({url:self.queryFsUrl(),dataType:'json'}).done(function(data){self.infoWindow(data);}).fail(function(){self.fsFail();});};};view.bounds=new google.maps.LatLngBounds();view.mapMarker=function(object){if(object.lat()===''||object.lat()===null||object.lat()===undefined){return null;}
var latlng={lat:object.lat(),lng:object.lng()};object.myMarker=new google.maps.Marker({position:latlng,map:view.map,title:object.name(),draggable:true,});view.bounds.extend(object.myMarker.position);view.markers.push(object.myMarker);};view.removeMarkers=function(){for(var i=0;i<view.markers.length;i++){view.markers[i].setMap(null);}};view.youAreHere=function(pos){view.infoWindow.setPosition(pos);view.infoWindow.setContent('You are here.');view.map.setCenter(pos);};view.initMap=function(){var pos={lat:34.0196,lng:-84.2025};view.map=new google.maps.Map(document.getElementsByClassName('map')[0],{scrollwheel:false,zoom:9,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.BOTTOM_CENTER},});view.infoWindow=new google.maps.InfoWindow({map:view.map,pixelOffset:new google.maps.Size(0,-30)});view.youAreHere(pos);view.map.setCenter(pos);};var ViewModel=function(){var self=this;this.currLocList=ko.observableArray([]);this.query=ko.observable('');this.addListen=function(object){if(view.map!==null){var map=view.map;map.fitBounds(view.bounds);}
if(object.myMarker===''||object.myMarker===null||object.myMarker===undefined){return null;}
google.maps.event.addListener(object.myMarker,'click',function(){self.currLoc().isSelected(false);object.isSelected(true);self.currLoc(object);object.fsWait(object);object.toggleBounce();});};this.search=ko.computed(function(){view.removeMarkers();self.currLocList([]);if(self.query()===''){view.removeMarkers();for(var i in locationList){self.currLocList.push(new Location(locationList[i]));}}else{for(var z in locationList){if(locationList[z].name.toLowerCase().indexOf(self.query().toLowerCase())>=0){self.currLocList.push(new Location(locationList[z]));}}
if(self.currLocList().length<1){self.currLocList.push(new Location(noResults[0]));}}
view.removeMarkers();for(var j=0;j<self.currLocList().length;j++){view.mapMarker(self.currLocList()[j]);self.addListen(self.currLocList()[j]);}});this.currLoc=ko.observable(self.currLocList()[0]);this.currLoc().isSelected(true);this.showInfo=function(click){self.currLoc().isSelected(false);self.currLoc(click);self.currLoc().isSelected(true);self.currLoc().fsWait(click);};setTimeout(function(){view.removeMarkers();for(var i=0;i<self.currLocList().length;i++){view.mapMarker(self.currLocList()[i]);self.addListen(self.currLocList()[i]);}},0);};ko.applyBindings(new ViewModel());view.initMap();});}